<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>前端监控简介 | 个人主页</title>
    <meta name="generator" content="VuePress 1.9.9">
    <link rel="icon" href="/img/logo.ico">
    <link rel="apple-touch-icon" href="/img/logo.png">
    <meta name="description" content="rh的博客">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;">
    
    <link rel="preload" href="/assets/css/0.styles.74a02103.css" as="style"><link rel="preload" href="/assets/js/app.54364397.js" as="script"><link rel="preload" href="/assets/js/2.ea1d54eb.js" as="script"><link rel="preload" href="/assets/js/13.ecaa558e.js" as="script"><link rel="prefetch" href="/assets/js/10.a13ce92a.js"><link rel="prefetch" href="/assets/js/11.c5493f60.js"><link rel="prefetch" href="/assets/js/12.0341abb4.js"><link rel="prefetch" href="/assets/js/14.d55c9a2b.js"><link rel="prefetch" href="/assets/js/15.b24cd0ee.js"><link rel="prefetch" href="/assets/js/16.7c38e7c7.js"><link rel="prefetch" href="/assets/js/17.fd15e051.js"><link rel="prefetch" href="/assets/js/18.a3beb2d7.js"><link rel="prefetch" href="/assets/js/19.4f970c5e.js"><link rel="prefetch" href="/assets/js/20.35661968.js"><link rel="prefetch" href="/assets/js/21.ec64587c.js"><link rel="prefetch" href="/assets/js/22.6e07b501.js"><link rel="prefetch" href="/assets/js/23.ba36c783.js"><link rel="prefetch" href="/assets/js/24.b6707acb.js"><link rel="prefetch" href="/assets/js/25.2dbfa4d5.js"><link rel="prefetch" href="/assets/js/26.03e28b6f.js"><link rel="prefetch" href="/assets/js/27.fd4a5887.js"><link rel="prefetch" href="/assets/js/28.364e737b.js"><link rel="prefetch" href="/assets/js/29.29942848.js"><link rel="prefetch" href="/assets/js/3.c931e90d.js"><link rel="prefetch" href="/assets/js/30.9185c6d1.js"><link rel="prefetch" href="/assets/js/31.a35eac1d.js"><link rel="prefetch" href="/assets/js/32.8096a1e0.js"><link rel="prefetch" href="/assets/js/33.407a449d.js"><link rel="prefetch" href="/assets/js/34.e2f81dbb.js"><link rel="prefetch" href="/assets/js/35.028c502e.js"><link rel="prefetch" href="/assets/js/36.2de3185a.js"><link rel="prefetch" href="/assets/js/37.7608c3f2.js"><link rel="prefetch" href="/assets/js/38.20651de8.js"><link rel="prefetch" href="/assets/js/39.2f5a06ea.js"><link rel="prefetch" href="/assets/js/4.9cbc8b55.js"><link rel="prefetch" href="/assets/js/40.4be51e8d.js"><link rel="prefetch" href="/assets/js/41.36a2e3f0.js"><link rel="prefetch" href="/assets/js/42.2cbf9afa.js"><link rel="prefetch" href="/assets/js/43.ce1c8073.js"><link rel="prefetch" href="/assets/js/44.b494f3f7.js"><link rel="prefetch" href="/assets/js/45.34035be8.js"><link rel="prefetch" href="/assets/js/46.ed534a1d.js"><link rel="prefetch" href="/assets/js/47.64e976a5.js"><link rel="prefetch" href="/assets/js/48.e197e0d5.js"><link rel="prefetch" href="/assets/js/49.f76dee05.js"><link rel="prefetch" href="/assets/js/5.1508cebe.js"><link rel="prefetch" href="/assets/js/50.ac9a636f.js"><link rel="prefetch" href="/assets/js/51.d924871e.js"><link rel="prefetch" href="/assets/js/52.388f4e26.js"><link rel="prefetch" href="/assets/js/53.f60541dc.js"><link rel="prefetch" href="/assets/js/54.f37be02d.js"><link rel="prefetch" href="/assets/js/55.06e6ce80.js"><link rel="prefetch" href="/assets/js/56.5f19dd4d.js"><link rel="prefetch" href="/assets/js/57.9398ec97.js"><link rel="prefetch" href="/assets/js/58.503e48ce.js"><link rel="prefetch" href="/assets/js/59.35603c7d.js"><link rel="prefetch" href="/assets/js/6.3c902562.js"><link rel="prefetch" href="/assets/js/60.f34179ae.js"><link rel="prefetch" href="/assets/js/61.c16de7a0.js"><link rel="prefetch" href="/assets/js/62.ac7dd70d.js"><link rel="prefetch" href="/assets/js/63.1f724cb5.js"><link rel="prefetch" href="/assets/js/64.85777ea3.js"><link rel="prefetch" href="/assets/js/65.270d5490.js"><link rel="prefetch" href="/assets/js/66.1c5e2582.js"><link rel="prefetch" href="/assets/js/67.87624fec.js"><link rel="prefetch" href="/assets/js/68.aca2d12f.js"><link rel="prefetch" href="/assets/js/69.a714dcd7.js"><link rel="prefetch" href="/assets/js/7.49f43c50.js"><link rel="prefetch" href="/assets/js/8.687ec09d.js"><link rel="prefetch" href="/assets/js/9.0a3f6f96.js">
    <link rel="stylesheet" href="/assets/css/0.styles.74a02103.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="个人主页" class="logo"> <span class="site-name can-hide">个人主页</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客文章" class="dropdown-title"><span class="title">博客文章</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客文章" class="mobile-dropdown-title"><span class="title">博客文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/test/" class="nav-link">
  测试
</a></li><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link router-link-active">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">
  杂文
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><a href="/readlog.html" class="nav-link">
  阅读日志
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <a href="https://github.com/JoeHR/vuePress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  主页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="博客文章" class="dropdown-title"><span class="title">博客文章</span> <span class="arrow down"></span></button> <button type="button" aria-label="博客文章" class="mobile-dropdown-title"><span class="title">博客文章</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/test/" class="nav-link">
  测试
</a></li><li class="dropdown-item"><!----> <a href="/frontend/" class="nav-link router-link-active">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link">
  linux
</a></li><li class="dropdown-item"><!----> <a href="/other/" class="nav-link">
  杂文
</a></li><li class="dropdown-item"><!----> <a href="/node/" class="nav-link">
  Node
</a></li><li class="dropdown-item"><!----> <a href="/python/" class="nav-link">
  Python
</a></li></ul></div></div><div class="nav-item"><a href="/readlog.html" class="nav-link">
  阅读日志
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于
</a></div> <a href="https://github.com/JoeHR/vuePress-blog" target="_blank" rel="noopener noreferrer" class="repo-link">
    Github
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>javascript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/js-js00.html" class="sidebar-link">JS基础</a></li><li><a href="/frontend/js-js01.html" class="sidebar-link">语音合成</a></li><li><a href="/frontend/js-js02.html" class="sidebar-link">JS循环优化</a></li><li><a href="/frontend/js-js03.html" class="sidebar-link">JS前端手写源码</a></li><li><a href="/frontend/js-js04.html" class="sidebar-link">JS前端实现十大经典排序算法</a></li><li><a href="/frontend/js-js05.html" class="sidebar-link">一些优秀的工具函数</a></li><li><a href="/frontend/js-reduce的使用技巧.html" class="sidebar-link">reduce的使用技巧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>css</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/css-css01.html" class="sidebar-link">css大法</a></li><li><a href="/frontend/css-css02.html" class="sidebar-link">css小技巧</a></li><li><a href="/frontend/css-css03.html" class="sidebar-link">css冷门技巧</a></li><li><a href="/frontend/css-css04.html" class="sidebar-link">你不知道的CSS</a></li><li><a href="/frontend/css-css基础.html" class="sidebar-link">css基础</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>React学习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/react-react01.html" class="sidebar-link">react的相关知识点</a></li><li><a href="/frontend/react-style-jsx.html" class="sidebar-link">styled-jsx在 jsx 中得应用</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>Vue学习</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/vue-vue01.html" class="sidebar-link">vue源码学习笔记01</a></li><li><a href="/frontend/vue-vue02.html" class="sidebar-link">vue 函数节流和防抖</a></li><li><a href="/frontend/vue-vue03.html" class="sidebar-link">vue 使用得一些小技巧</a></li><li><a href="/frontend/vue-vue04.html" class="sidebar-link">vue 相关面试题</a></li><li><a href="/frontend/vue-vue05.html" class="sidebar-link">vue-cli3项目 升级到 vue-cli4</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>工具</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/tool-rollup01.html" class="sidebar-link">rollupJs 打包工具</a></li><li><a href="/frontend/tool-performance.html" class="sidebar-link">performance性能调试工具</a></li><li><a href="/frontend/tool-npm.html" class="sidebar-link">用npm打造超溜的前端工作流</a></li><li><a href="/frontend/tool-mui.html" class="sidebar-link">muiJS</a></li><li><a href="/frontend/tool-eslint.html" class="sidebar-link">eslint</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>进阶</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/frontend/advanced-单例模式.html" class="sidebar-link">单例模式</a></li><li><a href="/frontend/advanced-装饰器模式.html" class="sidebar-link">装饰器模式</a></li><li><a href="/frontend/advanced-浏览器事件.html" class="sidebar-link">浏览器事件</a></li><li><a href="/frontend/advanced-虚拟Dom.html" class="sidebar-link">虚拟DOM简析</a></li><li><a href="/frontend/advanced-call,apply以及bind的使用与区别.html" class="sidebar-link">call,apply及bind得使用与区别</a></li><li><a href="/frontend/advanced-性能.html" class="sidebar-link">性能检测及加载优化</a></li><li><a href="/frontend/advanced-函数妙用.html" class="sidebar-link">高级函数</a></li><li><a href="/frontend/advanced-防篡改对象.html" class="sidebar-link">防篡改对象</a></li><li><a href="/frontend/advanced-前端监控.html" class="active sidebar-link">监控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#前端监控简介" class="sidebar-link">前端监控简介</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#性能监控" class="sidebar-link">性能监控</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#页面性能相关的几个时间" class="sidebar-link">页面性能相关的几个时间</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#采集这些性能数据的方法" class="sidebar-link">采集这些性能数据的方法</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#获取资源信息" class="sidebar-link">获取资源信息</a></li></ul></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#错误监控" class="sidebar-link">错误监控</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#数据上报" class="sidebar-link">数据上报</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#错误数据上报" class="sidebar-link">错误数据上报</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#spa" class="sidebar-link">SPA</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#用户信息收集" class="sidebar-link">用户信息收集</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#navigator" class="sidebar-link">navigator</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#uv-unique-visitor" class="sidebar-link">UV(Unique visitor)</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#pv-page-view" class="sidebar-link">PV(Page View)</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#页面停累时间" class="sidebar-link">页面停累时间</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#浏览深度" class="sidebar-link">浏览深度</a></li><li class="sidebar-sub-header"><a href="/frontend/advanced-前端监控.html#页面跳转来源" class="sidebar-link">页面跳转来源</a></li></ul></li></ul></li><li><a href="/frontend/advanced-前端埋点.html" class="sidebar-link">前端监控与埋点</a></li><li><a href="/frontend/advanced-dailyquestion.html" class="sidebar-link">面试题</a></li><li><a href="/frontend/advanced-web前端面试题.html" class="sidebar-link">刷面试</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="前端监控简介"><a href="#前端监控简介" class="header-anchor">#</a> 前端监控简介</h2> <p>Web承载的业务越来越复杂，用户对于Web的体验要求也越来越高，Web性能的优劣对业务收益也有着非常直接的影响。</p> <p>前端的开发环境比较复杂，页面在不同浏览器、微信等APP都可能展现不同，用户的网络网速、手机性能等，也会影响页面访问速度。在移动端可能更为明显，移动端用户对页面响应延迟、页面无法使用的容忍度更低。</p> <p>通常前端建立搭建监控体系，主要是为了监控页面的性能和错误，达到预警和追踪定位问题。因此监控又分为性能监控和错误监控</p> <h2 id="性能监控"><a href="#性能监控" class="header-anchor">#</a> 性能监控</h2> <p>性能监控一般利用<code>window.performance</code>来进行数据采集。</p> <blockquote><p>Performance 接口可以获取到当前页面中与性能相关的信息。它是 High Resolution Time API 的一部分，同时也融合了 Performance Timeline API、Navigation Timing API、 User Timing API 和 Resource Timing API</p></blockquote> <p>这个API的属性 <code>timing</code> ，包含了页面加载各个阶段的其实及结束时间</p> <p><img src="/assets/img/1605249942688.2211b01f.png" alt="1605249942688"></p> <p><img src="/assets/img/1604976081623.0f5eeb74.png" alt="1604976081623"></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
  <span class="token literal-property property">timing</span><span class="token operator">:</span> <span class="token punctuation">{</span>

    <span class="token comment">// 同一个浏览器上一个页面卸载（unload）结束时的时间戳，如果没有上一个页面，这个值和fetchSatrt的 相同</span>
    <span class="token literal-property property">navigationStart</span><span class="token operator">:</span> <span class="token number">1543806782096</span><span class="token punctuation">,</span>

    <span class="token comment">// 上一个页面 unload 事件抛出时的 时间戳，如果没有上一个页面，这个值会返回 0</span>
    <span class="token literal-property property">unloadEventStart</span><span class="token operator">:</span> <span class="token number">1543806782523</span><span class="token punctuation">,</span>

    <span class="token comment">// 和 unloadEventEnd 相对应，unload 事件处理完成时的 时间戳，如果没有上一个页面，这个值会返回0</span>
    <span class="token literal-property property">unloadEventEnd</span><span class="token operator">:</span> <span class="token number">1543806782523</span><span class="token punctuation">,</span>

    <span class="token comment">// 第一个 http 重定向开始时的时间戳，如果没有重定向，或者重定向中的一个不同源，这个值会返回0</span>
    <span class="token literal-property property">redirectStart</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>

    <span class="token comment">// 最后一个 http 重定向完成时（也就是所时http响应的最后一个比特字节被收到的时间）的时间戳</span>
    <span class="token comment">// 如果没有重定向，或者重定向中的一个不同源，这个值会返回0</span>
    <span class="token literal-property property">redirectEnd</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>

    <span class="token comment">// 浏览器准备好使用 http请求来获取（fetch）文档的时间戳，这个时间点会在检查任何应用缓存之前</span>
    <span class="token literal-property property">fetchStart</span><span class="token operator">:</span> <span class="token number">1543806782096</span><span class="token punctuation">,</span>

    <span class="token comment">// DNS 域名查询开始的unxi 时间戳</span>
    <span class="token comment">// 如果使用了持续连接（persistent connection） ，或者这个信息储存到了缓存或者本地资源上，这个值将和 fetchStart 一样</span>
    <span class="token literal-property property">domainLookupStart</span><span class="token operator">:</span> <span class="token number">1543806782096</span><span class="token punctuation">,</span>

    <span class="token comment">// DNS 域名查询完成的时间</span>
    <span class="token comment">// 如果使用了本地缓存（即无DNS查询）或持久连接，则与 fetchStart 值箱灯</span>
    <span class="token literal-property property">domainLookupEnd</span><span class="token operator">:</span> <span class="token number">1543806782096</span><span class="token punctuation">,</span>

    <span class="token comment">// Http (TCP) 域名查询结束的时间戳</span>
    <span class="token comment">// 如果使用了持续连接（persistent connection） 或者这个信息储存到缓存或本地子元素行，这个值将和fetchStart 一致</span>
    <span class="token literal-property property">connectStart</span><span class="token operator">:</span> <span class="token number">1543806782099</span><span class="token punctuation">,</span>

    <span class="token comment">// HTTP（TCP） 返回浏览器与服务器之间的连接建立时的时间戳。</span>
    <span class="token comment">// 如果建立的是持久连接，则返回值等同于fetchStart属性的值。连接建立指的是所有握手和认证过程全部结束。</span>
    <span class="token literal-property property">connectEnd</span><span class="token operator">:</span> <span class="token number">1543806782227</span><span class="token punctuation">,</span>

    <span class="token comment">// HTTPS 返回浏览器与服务器开始安全链接的握手时的时间戳。如果当前网页不要求安全连接，则返回0。</span>
    <span class="token literal-property property">secureConnectionStart</span><span class="token operator">:</span> <span class="token number">1543806782162</span><span class="token punctuation">,</span>

    <span class="token comment">// 返回浏览器向服务器发出HTTP请求时（或开始读取本地缓存时）的时间戳。</span>
    <span class="token literal-property property">requestStart</span><span class="token operator">:</span> <span class="token number">1543806782241</span><span class="token punctuation">,</span>

    <span class="token comment">// 返回浏览器从服务器收到（或从本地缓存读取）第一个字节时的时间戳。</span>
          <span class="token comment">//如果传输层在开始请求之后失败并且连接被重开，该属性将会被数制成新的请求的相对应的发起时间。</span>
    <span class="token literal-property property">responseStart</span><span class="token operator">:</span> <span class="token number">1543806782516</span><span class="token punctuation">,</span>

    <span class="token comment">// 返回浏览器从服务器收到（或从本地缓存读取，或从本地资源读取）最后一个字节时</span>
          <span class="token comment">//（如果在此之前HTTP连接已经关闭，则返回关闭时）的时间戳。</span>
    <span class="token literal-property property">responseEnd</span><span class="token operator">:</span> <span class="token number">1543806782537</span><span class="token punctuation">,</span>

    <span class="token comment">// 当前网页DOM结构开始解析时（即Document.readyState属性变为“loading”、相应的 readystatechange事件触发时）的时间戳。</span>
    <span class="token literal-property property">domLoading</span><span class="token operator">:</span> <span class="token number">1543806782573</span><span class="token punctuation">,</span>

    <span class="token comment">// 当前网页DOM结构结束解析、开始加载内嵌资源时（即Document.readyState属性变为“interactive”、相应的readystatechange事件触发时）的时间戳。</span>
    <span class="token literal-property property">domInteractive</span><span class="token operator">:</span> <span class="token number">1543806783203</span><span class="token punctuation">,</span>

    <span class="token comment">// 当解析器发送DOMContentLoaded 事件，即所有需要被执行的脚本已经被解析时的时间戳。</span>
    <span class="token literal-property property">domContentLoadedEventStart</span><span class="token operator">:</span> <span class="token number">1543806783203</span><span class="token punctuation">,</span>

    <span class="token comment">// 当所有需要立即执行的脚本已经被执行（不论执行顺序）时的时间戳。</span>
    <span class="token literal-property property">domContentLoadedEventEnd</span><span class="token operator">:</span> <span class="token number">1543806783216</span><span class="token punctuation">,</span>

    <span class="token comment">// 当前文档解析完成，即Document.readyState 变为 'complete'且相对应的readystatechange 被触发时的时间戳</span>
    <span class="token literal-property property">domComplete</span><span class="token operator">:</span> <span class="token number">1543806783796</span><span class="token punctuation">,</span>

    <span class="token comment">// load事件被发送时的时间戳。如果这个事件还未被发送，它的值将会是0。</span>
    <span class="token literal-property property">loadEventStart</span><span class="token operator">:</span> <span class="token number">1543806783796</span><span class="token punctuation">,</span>

    <span class="token comment">// 当load事件结束，即加载事件完成时的时间戳。如果这个事件还未被发送，或者尚未完成，它的值将会是0.</span>
    <span class="token literal-property property">loadEventEnd</span><span class="token operator">:</span> <span class="token number">1543806783802</span>
  <span class="token punctuation">}</span>

</code></pre></div><p>通过以上数据，我们可以得到几个有用的时间</p> <h3 id="页面性能相关的几个时间"><a href="#页面性能相关的几个时间" class="header-anchor">#</a> 页面性能相关的几个时间</h3> <ul><li>页面重定向耗时</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 重定向耗时</span>
<span class="token literal-property property">redirect</span><span class="token operator">:</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>redirectEnd <span class="token operator">-</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>redirectStart

</code></pre></div><ul><li>DOM 渲染耗时</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// DOM 渲染耗时</span>
<span class="token literal-property property">dom</span><span class="token operator">:</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>domComplete <span class="token operator">-</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>domLoading<span class="token punctuation">,</span>

</code></pre></div><ul><li>页面加载耗时</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 页面加载耗时</span>
<span class="token literal-property property">load</span><span class="token operator">:</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>loadEventEnd <span class="token operator">-</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>navigationStart<span class="token punctuation">,</span>

</code></pre></div><ul><li>页面卸载耗时</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 页面卸载耗时</span>
<span class="token literal-property property">unload</span><span class="token operator">:</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>unloadEventEnd <span class="token operator">-</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>unloadEventStart<span class="token punctuation">,</span>

</code></pre></div><ul><li>请求耗时</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 页面卸载耗时</span>
<span class="token literal-property property">request</span><span class="token operator">:</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>responseEnd <span class="token operator">-</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>requestStart<span class="token punctuation">,</span>

</code></pre></div><ul><li>获取性能信息时当前时间</li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 获取性能信息时当前时间</span>
<span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

</code></pre></div><ul><li>还有一个比较重要的时间就是<strong>白屏时间</strong>，它指从输入网址，到页面开始显示内容的时间</li></ul> <p>将以下脚本放在<code>&lt;/head&gt;</code> 前面就能获取白屏时间</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  whiteScreen <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> performance<span class="token punctuation">.</span>timing<span class="token punctuation">.</span>navigationStart
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>通过以上这几个时间，就可以得知页面首屏加载性能如何了</strong></p> <p>另外，通过 <code>window.performance.getEntriesByType('resource')</code> 这个方法，我们还可以获取相关资源（js、css、img...）的加载时间，它会返回页面当前所加载的所有资源。</p> <p><img src="/assets/img/1605145051689.2c3b2f1b.png" alt="1605145051689"></p> <p>它一般包括以下几个类型</p> <ul><li>script</li> <li>link</li> <li>img</li> <li>css</li> <li>fetch</li> <li>other</li> <li>xmlhttprequest</li></ul> <p>我们只需要哟个到以下几个信息</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// 资源的名称</span>
<span class="token literal-property property">name</span><span class="token operator">:</span> item<span class="token punctuation">.</span>name

<span class="token comment">// 资源加载耗时</span>
<span class="token literal-property property">duration</span><span class="token operator">:</span> item<span class="token punctuation">.</span>duration<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span>

<span class="token comment">// 资源大小</span>
<span class="token literal-property property">size</span><span class="token operator">:</span> item<span class="token punctuation">.</span>transferSize<span class="token punctuation">,</span>


<span class="token comment">// 资源所用协议</span>
<span class="token literal-property property">protocol</span><span class="token operator">:</span> item<span class="token punctuation">.</span>nextHopProtocol<span class="token punctuation">,</span>


</code></pre></div><h3 id="采集这些性能数据的方法"><a href="#采集这些性能数据的方法" class="header-anchor">#</a> 采集这些性能数据的方法</h3> <blockquote><p>获取性能信息</p></blockquote> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token keyword">const</span> <span class="token function-variable function">getPerformance</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>performance<span class="token punctuation">)</span> <span class="token keyword">return</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span>timing<span class="token punctuation">}</span> <span class="token operator">=</span> window<span class="token punctuation">.</span>performance
  <span class="token keyword">const</span> performanceTiming <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 重定向耗时</span>
    <span class="token literal-property property">redirect</span><span class="token operator">:</span> timing<span class="token punctuation">.</span>redirectEnd <span class="token operator">-</span> timing<span class="token punctuation">.</span>redirectStart<span class="token punctuation">,</span>

    <span class="token comment">// 白屏时间</span>
    <span class="token literal-property property">whiteScreen</span><span class="token operator">:</span> whiteScreen<span class="token punctuation">,</span>

    <span class="token comment">// dom渲染耗时</span>
    <span class="token literal-property property">dom</span><span class="token operator">:</span> timing<span class="token punctuation">.</span>domComplete <span class="token operator">-</span> timing<span class="token punctuation">.</span>navigationStart<span class="token punctuation">,</span>

    <span class="token comment">// 页面加载耗时</span>
    <span class="token literal-property property">load</span><span class="token operator">:</span> timing<span class="token punctuation">.</span>loadEventEnd <span class="token operator">-</span> timing<span class="token punctuation">.</span>navigationStart<span class="token punctuation">,</span>

    <span class="token comment">// 页面卸载耗时</span>
    <span class="token literal-property property">unload</span><span class="token operator">:</span> timing<span class="token punctuation">.</span>unloadEventEnd <span class="token operator">-</span> timing<span class="token punctuation">.</span>unloadEventStart<span class="token punctuation">,</span>

    <span class="token comment">// 请求耗时</span>
    <span class="token literal-property property">request</span><span class="token operator">:</span> timing<span class="token punctuation">.</span>responseEnd <span class="token operator">-</span> timing<span class="token punctuation">.</span>requestStart<span class="token punctuation">,</span>

    <span class="token comment">// 获取性能信息时当前时间</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> performanceTiming

<span class="token punctuation">}</span>

</code></pre></div><h3 id="获取资源信息"><a href="#获取资源信息" class="header-anchor">#</a> 获取资源信息</h3> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// 获取资源信息</span>
<span class="token keyword">const</span> <span class="token function-variable function">getResources</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>window<span class="token punctuation">.</span>performance<span class="token punctuation">)</span> <span class="token keyword">return</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> window<span class="token punctuation">.</span>performance<span class="token punctuation">.</span><span class="token function">getEntriesByType</span><span class="token punctuation">(</span><span class="token string">'resource'</span><span class="token punctuation">)</span>
    <span class="token keyword">const</span> resource <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">xmlhttprequest</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">css</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">other</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">script</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">img</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">link</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token literal-property property">fetch</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 获取资源信息时当前时间</span>
        <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    data<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> arry <span class="token operator">=</span> resource<span class="token punctuation">[</span>item<span class="token punctuation">.</span>initiatorType<span class="token punctuation">]</span>
        arry <span class="token operator">&amp;&amp;</span> arry<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            <span class="token comment">// 资源的名称</span>
            <span class="token literal-property property">name</span><span class="token operator">:</span> item<span class="token punctuation">.</span>name<span class="token punctuation">,</span>
            <span class="token comment">// 资源加载耗时</span>
            <span class="token literal-property property">duration</span><span class="token operator">:</span> item<span class="token punctuation">.</span>duration<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// 资源大小</span>
            <span class="token literal-property property">size</span><span class="token operator">:</span> item<span class="token punctuation">.</span>transferSize<span class="token punctuation">,</span>
            <span class="token comment">// 资源所用协议</span>
            <span class="token literal-property property">protocol</span><span class="token operator">:</span> item<span class="token punctuation">.</span>nextHopProtocol<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>

    <span class="token keyword">return</span> resource
<span class="token punctuation">}</span>

</code></pre></div><h2 id="错误监控"><a href="#错误监控" class="header-anchor">#</a> 错误监控</h2> <p>前端能捕获到错误有三种</p> <ol><li>资源加载错误，通过 <code>addEventListener('error',callback,true)</code>在捕获阶段捕捉资源加载失败错误</li> <li>js执行错误，通过 <code>window.onerror</code>捕捉js错误</li> <li>promise 错误，通过 <code>addEventListener('unhandledrejection',callback)</code>捕捉 promise 错误，但是没有发生错误的行数，列数等信息，只能手动抛出相关错误信息</li></ol> <p>我们可以建一个错误数组变量<code>errors</code>在错误发生时，将错误的相关信息添加到数组，然后在某个阶段统一上报，具体如何操作请看代码</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// 捕获资源加载失败错误  js css img ...</span>
<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> target <span class="token punctuation">}</span> <span class="token operator">=</span> e
  <span class="token keyword">if</span><span class="token punctuation">(</span>target <span class="token operator">!=</span> window<span class="token punctuation">)</span><span class="token punctuation">{</span>
    monitor<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">type</span><span class="token operator">:</span> target<span class="token punctuation">.</span>localName<span class="token punctuation">,</span>
      <span class="token literal-property property">url</span><span class="token operator">:</span> target<span class="token punctuation">.</span>src <span class="token operator">||</span> target<span class="token punctuation">.</span>href<span class="token punctuation">,</span>
      <span class="token literal-property property">msg</span><span class="token operator">:</span> <span class="token punctuation">(</span>target<span class="token punctuation">.</span>src <span class="token operator">||</span> target<span class="token punctuation">.</span>href<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">' is load error'</span><span class="token punctuation">,</span>
      <span class="token comment">// 错误发生时间</span>
      <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span>


<span class="token comment">// 监听 js 错误</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span>url<span class="token punctuation">,</span>row<span class="token punctuation">,</span>col<span class="token punctuation">,</span>error</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  monitor<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'javascript'</span><span class="token punctuation">,</span>
    row<span class="token punctuation">,</span>
    col<span class="token punctuation">,</span>
    <span class="token literal-property property">msg</span><span class="token operator">:</span> error <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>stack <span class="token operator">?</span> error<span class="token punctuation">.</span>stack <span class="token operator">:</span> msg<span class="token punctuation">,</span>
    url<span class="token punctuation">,</span>
    <span class="token comment">// 错误发生的时间</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>


<span class="token comment">// 监听 promise 错误 缺点时获取不到行数数据</span>
<span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'unhandledrejection'</span><span class="token punctuation">,</span><span class="token parameter">e</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  minitor<span class="token punctuation">.</span>errors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">type</span><span class="token operator">:</span><span class="token string">'promise'</span><span class="token punctuation">,</span>
    <span class="token literal-property property">msg</span><span class="token operator">:</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>reason <span class="token operator">&amp;&amp;</span> e<span class="token punctuation">.</span>reason<span class="token punctuation">.</span>msg<span class="token punctuation">)</span> <span class="token operator">||</span> e<span class="token punctuation">.</span>reason <span class="token operator">||</span> <span class="token string">''</span><span class="token punctuation">,</span>
    <span class="token comment">// 错误发生时间</span>
    <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="数据上报"><a href="#数据上报" class="header-anchor">#</a> 数据上报</h2> <p>性能数据可以在页面加载完成之后上报，尽量不要对页面性能产生影响</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>window<span class="token punctuation">.</span><span class="token function-variable function">onload</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  <span class="token comment">// 在浏览器空闲时间获取性能及资源信息</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>widnow<span class="token punctuation">.</span>requestIdleCallback<span class="token punctuation">)</span><span class="token punctuation">{</span>
    window<span class="token punctuation">.</span><span class="token function">requestIdleCallback</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      monitor<span class="token punctuation">.</span>performance <span class="token operator">=</span> <span class="token function">getPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      monitor<span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>
    <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            monitor<span class="token punctuation">.</span>performance <span class="token operator">=</span> <span class="token function">getPerformance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            monitor<span class="token punctuation">.</span>resources <span class="token operator">=</span> <span class="token function">getResources</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><p>当然，你也可以设一个定时器，循环上报。不过每次上报最好做一下去重再上报，避免同样的数据重复上报</p> <h2 id="错误数据上报"><a href="#错误数据上报" class="header-anchor">#</a> 错误数据上报</h2> <p>错误上报可以在用一个 <code>errors</code>数组收集所有的错误，再在某一阶段统一上报（延时上报）。其实，也可以改成在错误发生时上报（即时上报）。这样可以避免在收集完错误延时上报还没触发，用户却已经关掉网页导致数据丢失的问题。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token comment">// 监听 js 错误</span>
window<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">msg<span class="token punctuation">,</span> url<span class="token punctuation">,</span> row<span class="token punctuation">,</span> col<span class="token punctuation">,</span> error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">type</span><span class="token operator">:</span> <span class="token string">'javascript'</span><span class="token punctuation">,</span>
        <span class="token literal-property property">row</span><span class="token operator">:</span> row<span class="token punctuation">,</span>
        <span class="token literal-property property">col</span><span class="token operator">:</span> col<span class="token punctuation">,</span>
        <span class="token literal-property property">msg</span><span class="token operator">:</span> error <span class="token operator">&amp;&amp;</span> error<span class="token punctuation">.</span>stack<span class="token operator">?</span> error<span class="token punctuation">.</span>stack <span class="token operator">:</span> msg<span class="token punctuation">,</span>
        <span class="token literal-property property">url</span><span class="token operator">:</span> url<span class="token punctuation">,</span>
        <span class="token comment">// 错误发生的时间</span>
        <span class="token literal-property property">time</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 即时上报</span>
    axios<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">url</span><span class="token operator">:</span> <span class="token string">'xxx'</span><span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="spa"><a href="#spa" class="header-anchor">#</a> SPA</h2> <p><code>window.performance</code>API是有缺点的，在SPA 切换路由时，<code>window.performance.timing</code>的数据不会更新。所以我们需要另想办法来统计切换路由到加载完成的时间，以Vue为例，一个可行的办法就是切换路由时，在路由的全局前置首位<code>beforeEach</code>里获取开始时间，在组件的<code>mounted</code>钩子里执行<code>vm.$nextTick</code>函数来获取组件的渲染完毕时间。</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
router<span class="token punctuation">.</span><span class="token function">beforeEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> from<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
	store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setPageLoadedStartTime'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre></div><div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">$nextTick</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span><span class="token function">commit</span><span class="token punctuation">(</span><span class="token string">'setPageLoadedTime'</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$store<span class="token punctuation">.</span>state<span class="token punctuation">.</span>pageLoadedStartTime<span class="token punctuation">)</span>
	<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre></div><h2 id="用户信息收集"><a href="#用户信息收集" class="header-anchor">#</a> 用户信息收集</h2> <p>除了性能监控和错误监控，前端监控还可以用于用户信息收集</p> <h3 id="navigator"><a href="#navigator" class="header-anchor">#</a> navigator</h3> <p>使用<code>widnow.navigator</code>可以收集到用户的设备信息，操作系统，浏览器信息...</p> <p><code>navigator</code> API 中包含哪些可以搜集的用户信息</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code>
<span class="token literal-property property">navigator</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 浏览器是否联网 true-联网 false-未联网</span>
    <span class="token literal-property property">online</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>

    <span class="token comment">// 用户信息</span>
    <span class="token literal-property property">userAgent</span><span class="token operator">:</span> <span class="token string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.183 Safari/537.36&quot;</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="uv-unique-visitor"><a href="#uv-unique-visitor" class="header-anchor">#</a> UV(Unique visitor)</h3> <p>是指通过互联网访问，浏览这个网页的自然人。访问网站的一台电脑客户端为一个访客。00：00 ~ 24：00 内相同的客户端只被计算一次。一天内同个访客多次访问仅计算一个 <code>UV</code>。在用户访问网站时，可以生成一个随机字符串+时间日期，保存在本地。在网页发生请求时（如果超过当天24小时，则重新生成），把这些参数传到后端，后端利用这些信息生成<code>UV</code>统计报告。</p> <h3 id="pv-page-view"><a href="#pv-page-view" class="header-anchor">#</a> PV(Page View)</h3> <p>即页面浏览量或点击量，用户每一次对网站中的每个网页访问均被记录一个<code>PV</code>。用户对同一页面的多次访问，访问量累计，用以衡量网站用户访问的网页数量。</p> <h3 id="页面停累时间"><a href="#页面停累时间" class="header-anchor">#</a> 页面停累时间</h3> <p><strong>传统网站</strong>用户在进入A页面时，通过后台请求把用户进入页面的时间捎上。过了10分钟，用户进入B页面，这时后台可以通过接口捎带的参数可以判断用户在A页面停留了10分钟。<strong>SPA</strong>可以利用<code>router</code>来获取用户停留时间，拿Vue距离，通过<code>router.beforeEach</code>、 <code>destroy</code>这两个钩子函数来获取用户停留该路由组件的时间。</p> <h3 id="浏览深度"><a href="#浏览深度" class="header-anchor">#</a> 浏览深度</h3> <p>通过<code>document.documentElement.scrollTop</code>属性以及屏幕高度，可以判断用户是否浏览完网站内容</p> <h3 id="页面跳转来源"><a href="#页面跳转来源" class="header-anchor">#</a> 页面跳转来源</h3> <p>通过<code>document.referer</code>属性，可以知道用户是从哪个网站跳转而来</p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">最后更新时间:</span> <span class="time">2/21/2022, 3:29:09 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/frontend/advanced-防篡改对象.html" class="prev">
        防篡改对象
      </a></span> <span class="next"><a href="/frontend/advanced-前端埋点.html">
        前端监控与埋点
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.54364397.js" defer></script><script src="/assets/js/2.ea1d54eb.js" defer></script><script src="/assets/js/13.ecaa558e.js" defer></script>
  </body>
</html>
